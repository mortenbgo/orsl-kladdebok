name: "üìù Create Deployment Request"

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to request deployment for'
        required: true
        type: choice
        options:
          - dev
          - qa
          - prod
      reason:
        description: 'Reason for deployment'
        required: true
        type: string

jobs:
  create-request:
    name: "Create deployment request"
    runs-on: ubuntu-latest
    steps:
      - name: Create deployment request issue
        run: |
          ISSUE_TITLE="üöÄ Deployment Request: ${{ inputs.environment }} - $(date +%Y-%m-%d)"
          ISSUE_BODY="## Deployment Request
          
          **Environment:** ${{ inputs.environment }}
          **Requested by:** ${{ github.actor }}
          **Commit:** ${{ github.sha }}
          **Reason:** ${{ inputs.reason }}
          
          ### Quick Actions
          
          #### ‚úÖ Approve and Deploy
          \`\`\`yaml
          # Click the button below to approve and start deployment
          \`\`\`
          
          **[üöÄ APPROVE & DEPLOY](${{ github.server_url }}/${{ github.repository }}/actions/workflows/deployment-dashboard.yaml/dispatch?inputs.environment=${{ inputs.environment }}&inputs.commit_sha=${{ github.sha }})**
          
          #### ‚ùå Reject
          Comment: \`‚ùå REJECT - [reason]\`
          
          ---
          *Auto-generated deployment request*"
          
          gh issue create \
            --title "$ISSUE_TITLE" \
            --body "$ISSUE_BODY" \
            --label "deployment-request,${{ inputs.environment }}-deployment" \
            --assignee "your-deployment-team"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}